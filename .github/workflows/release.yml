name: Release

permissions: {}

on:
  push:
    tags: ["v*.*.*"]

jobs:
  release:
    name: Release
    uses: grafana/xk6/.github/workflows/extension-release.yml@v1.1.4
    permissions:
      contents: write
    with:
      go-version: "1.24.x"
      os: '["linux"]'
      arch: '["amd64"]'
      k6-version: "v1.2.3"
      xk6-version: "1.1.4"

  register-version:
    name: Register Version
    needs: release
    uses: pablochacin/k6-extension-registry/.github/workflows/update-registry.yml@main
    with:
      module: github.com/pablochacin/xk6-example
      version: ${{ github.ref_name }}
      repository-url: ${{ github.server_url }}/${{ github.repository }}
      release-url: ${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ github.ref_name }}
